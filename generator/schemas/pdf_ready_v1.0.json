{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/AbsaOSS/living-doc-generator-pdf/schemas/pdf_ready_v1.0.json",
  "title": "PDF-Ready JSON Schema v1.0",
  "description": "Canonical JSON format for Living Documentation PDF Generator",
  "type": "object",
  "required": ["schema_version", "meta", "content"],
  "properties": {
    "schema_version": {
      "type": "string",
      "const": "1.0",
      "description": "Schema version, must be exactly '1.0'"
    },
    "meta": {
      "type": "object",
      "required": [
        "document_title",
        "document_version",
        "generated_at",
        "source_set",
        "selection_summary"
      ],
      "properties": {
        "document_title": {
          "type": "string",
          "minLength": 1,
          "maxLength": 200,
          "pattern": "^.*\\S.*$",
          "description": "Document title (1-200 characters, non-empty after trimming)"
        },
        "document_version": {
          "type": "string",
          "minLength": 1,
          "maxLength": 50,
          "pattern": "^.*\\S.*$",
          "description": "Document version (1-50 characters, semver recommended)"
        },
        "generated_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 UTC timestamp"
        },
        "source_set": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "string",
            "minLength": 1,
            "pattern": "^.*\\S.*$"
          },
          "description": "Non-empty array of source identifiers"
        },
        "selection_summary": {
          "type": "object",
          "required": ["total_items", "included_items", "excluded_items"],
          "properties": {
            "total_items": {
              "type": "integer",
              "minimum": 0,
              "description": "Total number of items"
            },
            "included_items": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of included items"
            },
            "excluded_items": {
              "type": "integer",
              "minimum": 0,
              "description": "Number of excluded items"
            }
          },
          "additionalProperties": false
        },
        "run_context": {
          "type": "object",
          "properties": {
            "ci_run_id": {
              "type": "string"
            },
            "triggered_by": {
              "type": "string"
            },
            "branch": {
              "type": "string"
            },
            "commit_sha": {
              "type": "string"
            }
          },
          "additionalProperties": false,
          "description": "Optional CI/CD run context"
        }
      },
      "additionalProperties": false
    },
    "content": {
      "type": "object",
      "required": ["user_stories"],
      "properties": {
        "user_stories": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "title", "state", "tags", "url", "timestamps", "sections"],
            "properties": {
              "id": {
                "type": "string",
                "minLength": 1,
                "maxLength": 200,
                "description": "Unique canonical stable ID"
              },
              "title": {
                "type": "string",
                "minLength": 1,
                "maxLength": 500,
                "pattern": "^.*\\S.*$",
                "description": "Non-empty title"
              },
              "state": {
                "type": "string",
                "minLength": 1,
                "description": "State (e.g., 'open', 'closed')"
              },
              "tags": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Array of tags"
              },
              "url": {
                "type": "string",
                "format": "uri",
                "pattern": "^https?://",
                "description": "Valid URL (http/https)"
              },
              "timestamps": {
                "type": "object",
                "required": ["created", "updated"],
                "properties": {
                  "created": {
                    "type": "string",
                    "format": "date-time",
                    "description": "ISO 8601 timestamp"
                  },
                  "updated": {
                    "type": "string",
                    "format": "date-time",
                    "description": "ISO 8601 timestamp"
                  }
                },
                "additionalProperties": false
              },
              "sections": {
                "type": "object",
                "properties": {
                  "description": {
                    "type": ["string", "null"],
                    "description": "Markdown content"
                  },
                  "business_value": {
                    "type": ["string", "null"],
                    "description": "Markdown content"
                  },
                  "preconditions": {
                    "type": ["string", "null"],
                    "description": "Markdown content"
                  },
                  "acceptance_criteria": {
                    "type": ["string", "null"],
                    "description": "Markdown content"
                  },
                  "user_guide": {
                    "type": ["string", "null"],
                    "description": "Markdown content"
                  },
                  "connections": {
                    "type": ["string", "null"],
                    "description": "Markdown content"
                  },
                  "last_edited": {
                    "type": ["string", "null"],
                    "description": "Markdown content"
                  }
                },
                "additionalProperties": false
              }
            },
            "additionalProperties": false
          },
          "description": "Array of user stories (can be empty)"
        },
        "overview": {
          "type": "object",
          "properties": {
            "summary_stats": {
              "type": "object"
            },
            "index_tables": {
              "type": "array"
            }
          },
          "description": "Optional overview section"
        },
        "coverage_matrix": {
          "type": "object",
          "properties": {
            "version": {
              "type": "string"
            },
            "matrix_data": {
              "type": "array"
            }
          },
          "description": "Optional coverage matrix"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
